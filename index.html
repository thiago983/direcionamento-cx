<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dimensionamento CX</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    .container {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .scope {
      background: #7caf94;
      border-radius: 8px;
      padding: 10px;
      width: 260px;
      min-height: 160px;
      box-sizing: border-box;
    }

    .scope.drag-over {
      outline: 3px dashed #205452;
    }

    .scope h3 {
      text-align: center;
      margin: 6px 0 10px;
      color: #fff;
      font-size: 15px;
    }

    .people {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .person {
      background: #205452;
      color: #ffffff;
      padding: 6px 8px;
      border-radius: 6px;
      cursor: grab;
      user-select: none;
    }

    .person.fixed {
      outline: 2px solid #ffffff;
    }

    .base {
      margin-top: 20px;
      padding: 10px;
      background: #ddd;
      border-radius: 8px;
    }

    button {
      margin-right: 10px;
      padding: 8px 14px;
      cursor: pointer;
    }

    textarea {
      width: 100%;
      height: 180px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>Dimensionamento CX</h2>

<div class="container" id="scopes"></div>

<div class="base">
  <strong>Base</strong>
  <div class="people" id="base"></div>
</div>

<br />

<button onclick="resetAll()">Resetar</button>
<button onclick="copyList()">Copiar tudo</button>

<textarea id="output" readonly></textarea>

<script>
const scopeNames = [
  "Atendimento",
  "Backoffice",
  "Reputação",
  "Qualidade",
  "Treinamento"
];

const peopleNames = [
  "Ana Luiza",
  "Kelly Ribeiro",
  "João",
  "Marina",
  "Carlos",
  "Fernanda",
  "Rafael",
  "Bianca"
];

let state = JSON.parse(localStorage.getItem("cxState")) || {
  scopes: {},
  fixed: {}
};

function saveState() {
  localStorage.setItem("cxState", JSON.stringify(state));
}

function createPerson(name) {
  const div = document.createElement("div");
  div.className = "person";
  div.textContent = name;
  div.draggable = true;

  if (state.fixed[name]) {
    div.classList.add("fixed");
  }

  div.addEventListener("dragstart", e => {
    e.dataTransfer.setData("text/plain", name);
  });

  div.addEventListener("dblclick", () => {
    state.fixed[name] = !state.fixed[name];
    div.classList.toggle("fixed");
    saveState();
  });

  return div;
}

function createScope(scope) {
  const card = document.createElement("div");
  card.className = "scope";

  const title = document.createElement("h3");
  title.textContent = scope;
  card.appendChild(title);

  const peopleDiv = document.createElement("div");
  peopleDiv.className = "people";

  card.addEventListener("dragover", e => {
    e.preventDefault();
    card.classList.add("drag-over");
  });

  card.addEventListener("dragleave", () => {
    card.classList.remove("drag-over");
  });

  card.addEventListener("drop", e => {
    e.preventDefault();
    card.classList.remove("drag-over");

    const name = e.dataTransfer.getData("text/plain");

    Object.values(state.scopes).forEach(arr => {
      const i = arr.indexOf(name);
      if (i > -1) arr.splice(i, 1);
    });

    state.scopes[scope] = state.scopes[scope] || [];
    if (!state.scopes[scope].includes(name)) {
      state.scopes[scope].push(name);
    }

    render();
    saveState();
  });

  card.appendChild(peopleDiv);
  return { card, peopleDiv };
}

function render() {
  const scopesDiv = document.getElementById("scopes");
  const baseDiv = document.getElementById("base");

  scopesDiv.innerHTML = "";
  baseDiv.innerHTML = "";

  const used = new Set();

  scopeNames.forEach(scope => {
    const { card, peopleDiv } = createScope(scope);

    (state.scopes[scope] || []).forEach(name => {
      const p = createPerson(name);
      peopleDiv.appendChild(p);
      used.add(name);
    });

    scopesDiv.appendChild(card);
  });

  peopleNames.forEach(name => {
    if (!used.has(name)) {
      baseDiv.appendChild(createPerson(name));
    }
  });

  generateList();
}

function resetAll() {
  Object.keys(state.scopes).forEach(scope => {
    state.scopes[scope] = state.scopes[scope].filter(
      name => state.fixed[name]
    );
  });
  saveState();
  render();
}

function generateList() {
  let text = "";

  scopeNames.forEach(scope => {
    const people = state.scopes[scope] || [];
    if (people.length) {
      text += `- ${scope}\n`;
      people.forEach(p => text += `${p}\n`);
      text += `\n`;
    }
  });

  document.getElementById("output").value = text.trim();
}

function copyList() {
  const ta = document.getElementById("output");
  ta.select();
  document.execCommand("copy");
}

render();
</script>

</body>
</html>

