<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Dimensionamento CX</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  font-family: Inter, Arial, sans-serif;
  background: #f3f5f6;
  margin: 0;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 16px;
}

.container {
  display: grid;
  grid-template-columns: 1fr 3fr;
  gap: 16px;
}

.base, .escopos {
  background: #ffffff;
  border-radius: 12px;
  padding: 12px;
}

.base {
  max-height: 85vh;
  overflow-y: auto;
}

.pessoas {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 8px;
}

.pessoa {
  background: #205452;
  color: #ffffff;
  padding: 8px;
  border-radius: 8px;
  cursor: grab;
  font-size: 13px;
  position: relative;
  user-select: none;
  text-align: center;
}

.pessoa.fixa {
  outline: 2px solid #f0ac63;
}

.lock {
  position: absolute;
  top: 4px;
  right: 6px;
  font-size: 12px;
}

.escopos {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 12px;
}

.escopo {
  background: #7caf94;
  border-radius: 12px;
  padding: 10px;
  min-height: 140px;
}

.escopo.ferias {
  background: #f0ac63;
}

.escopo h3 {
  text-align: center;
  margin: 4px 0 8px 0;
  font-size: 14px;
}

.dropzone {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.controls {
  margin-top: 12px;
  display: flex;
  gap: 8px;
  justify-content: center;
}

button {
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}

button.reset {
  background: #e45b5b;
  color: white;
}

button.copy {
  background: #205452;
  color: white;
}
</style>
</head>

<body>

<h1>Dimensionamento CX</h1>

<div class="container">

  <!-- BASE -->
  <div class="base">
    <h3>Pessoas</h3>
    <div class="pessoas" id="base"></div>
  </div>

  <!-- ESCOPOS -->
  <div class="escopos" id="escopos"></div>

</div>

<div class="controls">
  <button class="reset" onclick="resetar()">Resetar</button>
  <button class="copy" onclick="copiarLista()">Copiar lista</button>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCFRS8ALYUjtPwdMBStkBEHp9e6gwrH-fk",
  authDomain: "direcionamentocx.firebaseapp.com",
  projectId: "direcionamentocx",
  storageBucket: "direcionamentocx.firebasestorage.app",
  messagingSenderId: "545135608907",
  appId: "1:545135608907:web:c968470b718ea7053a79ce"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const docRef = db.collection("estado").doc("escala");

/* DADOS */
const pessoasLista = [
"Camila Marigo","Cauane Wiggberto","Daniela Barral","Elisabete Pinho",
"Erick Muniz","Gisele Lopes","Jenifer Alcantara","JoÃ£o Pedro Finamore",
"Johana Geisa","Karina Tosta","Leonardo Santiago","Lorenzo Moreira",
"Luisa Rodrigues","Luiz Felipe Firmo","Maria Clara Periard","Natanael Cruz",
"Rayanne Rodrigues","Samantha MarÃ§al","Jessyca Rodrigues","Rayssa MagalhÃ£es Farias",
"Dayane da Silva Santos","Matheus AndrÃ©","Lais Rodrigues","Marianne Belmiro",
"HÃ©rica Oliveira","Julia Prazeres","Wesley Freitas","Milena Cabral",
"Thariny Portela","Patricia Rodrigues","Pedro Bento","Ana Luiza",
"Kelly Ribeiro","Nayara Marinho","Ana FlÃ¡via","Barbara Oliveira","Lucas Resende"
];

const escoposLista = [
"Manual WPP","Manual Email","Manual Chat",
"Social","Voy","Backoffice","Reclame Aqui",
"FÃ©rias / LicenÃ§a / Outros"
];

const base = document.getElementById("base");
const escoposDiv = document.getElementById("escopos");

let estadoLocal = {};

/* CRIA UI */
pessoasLista.forEach(nome => criarPessoa(nome));
escoposLista.forEach(e => criarEscopo(e));

/* FUNÃ‡Ã•ES */
function criarPessoa(nome) {
  const div = document.createElement("div");
  div.className = "pessoa";
  div.textContent = nome;
  div.dataset.nome = nome;
  div.draggable = true;

  div.ondragstart = e => e.dataTransfer.setData("nome", nome);

  div.ondblclick = () => {
    div.classList.toggle("fixa");
    salvarEstado();
  };

  base.appendChild(div);
}

function criarEscopo(nome) {
  const card = document.createElement("div");
  card.className = "escopo";
  if (nome.includes("FÃ©rias")) card.classList.add("ferias");

  const h3 = document.createElement("h3");
  h3.textContent = nome;

  const dz = document.createElement("div");
  dz.className = "dropzone";
  dz.dataset.escopo = nome;

  dz.ondragover = e => e.preventDefault();
  dz.ondrop = e => {
    const nomePessoa = e.dataTransfer.getData("nome");
    const pessoa = document.querySelector(`[data-nome="${nomePessoa}"]`);
    dz.appendChild(pessoa);
    salvarEstado();
  };

  card.appendChild(h3);
  card.appendChild(dz);
  escoposDiv.appendChild(card);
}

function salvarEstado() {
  const dados = [];

  document.querySelectorAll(".pessoa").forEach(p => {
    const parent = p.parentElement.classList.contains("dropzone")
      ? p.parentElement.dataset.escopo
      : "base";

    dados.push({
      nome: p.dataset.nome,
      escopo: parent,
      fixo: p.classList.contains("fixa")
    });
  });

  docRef.set({ agentes: dados });
}

function resetar() {
  document.querySelectorAll(".pessoa").forEach(p => {
    if (!p.classList.contains("fixa")) base.appendChild(p);
  });
  salvarEstado();
}

function copiarLista() {
  let texto = "";
  escoposLista.forEach(e => {
    if (e.includes("FÃ©rias")) return;
    texto += `- ${e}\n`;
    document.querySelectorAll(`[data-escopo="${e}"] .pessoa`)
      .forEach(p => texto += p.dataset.nome + "\n");
    texto += "\n";
  });
  navigator.clipboard.writeText(texto);
}

/* ðŸ”„ SINCRONIZAÃ‡ÃƒO EM TEMPO REAL */
docRef.onSnapshot(doc => {
  if (!doc.exists) return;
  const dados = doc.data().agentes;

  document.querySelectorAll(".pessoa").forEach(p => base.appendChild(p));

  dados.forEach(d => {
    const p = document.querySelector(`[data-nome="${d.nome}"]`);
    if (!p) return;

    p.classList.toggle("fixa", d.fixo);

    if (d.escopo !== "base") {
      document
        .querySelector(`[data-escopo="${d.escopo}"]`)
        ?.appendChild(p);
    }
  });
});
</script>

</body>
</html>
